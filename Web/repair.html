<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Gruzdintuvė - Register Repair</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

<header>
    <h1><a href="index.html" style="color:white; text-decoration:none">MECHPRO Auto Repair</a></h1>
    <p>Fast • Professional • Reliable</p>
</header>

<nav>
    <a href="index.html">Home</a>
    <a href="services.html">Services</a>
    <a href="diagnostics.html">Diagnostics</a>
    <a href="contacts.html">Contacts</a>
    <a href="repair.html" class="active">Repair Registration</a>
</nav>

<div class="container" style="display:flex; gap:20px; align-items:flex-start; flex-wrap:wrap;">

    <!-- LEFT: Repair form -->
    <div class="card" style="flex:2; min-width:320px;">
      <h2>Repair Registration</h2>
      <p>Fill the form and choose the area of the car that needs attention. We’ll contact you to confirm the appointment.</p>

      <form id="repairForm">
        <div class="form-row">
          <label for="firstName">First name</label>
          <input id="firstName" type="text" placeholder="Jonas" required>
        </div>

        <div class="form-row">
          <label for="lastName">Last name</label>
          <input id="lastName" type="text" placeholder="Jonaitis" required>
        </div>

        <div class="form-row">
          <label for="plate">Plate number</label>
          <input id="plate" type="text" placeholder="ABC123" required>
        </div>

        <div class="form-row">
          <label for="phone">Phone</label>
          <input id="phone" type="tel" placeholder="860000000" required>
        </div>

        <div class="form-row">
          <label for="description">Short description of problem</label>
          <textarea id="description" rows="4" placeholder="Describe strange noises, lights, vibrations..."></textarea>
        </div>

        <div class="form-row">
          <strong>Selected area:</strong>
          <span id="pickedArea">Nenurodyta</span>
        </div>

        <div class="form-row">
          <h3>Symptoms</h3>
          <label><input type="checkbox" name="symptom" value="engine_knock"> Engine knocking</label><br>
          <label><input type="checkbox" name="symptom" value="warning_light"> Dashboard warning light</label><br>
          <label><input type="checkbox" name="symptom" value="hard_start"> Hard to start</label><br>
          <label><input type="checkbox" name="symptom" value="vibrations"> Strong vibrations</label><br>
          <label><input type="checkbox" name="symptom" value="overheating"> Engine overheating</label><br>
          <label><input type="checkbox" name="symptom" value="brake_noise"> Brake noise</label><br>
        </div>

        <div style="margin-top:12px; display:flex; gap:12px; align-items:center;">
          <label style="display:flex; align-items:center; gap:8px;">
            <input type="checkbox" id="pickupOpt" /> Reikia pasiimti automobilį (pickup)
          </label>
        </div>

        <div style="margin-top:12px;">
          <label style="font-weight:700; display:block; margin-bottom:8px">Papildoma informacija</label>
          <textarea id="description" rows="6" placeholder="Trumpas paaiškinimas..."></textarea>
        </div>

        <!-- hidden field storing selected car area -->
        <input type="hidden" id="selectedArea" />

        <div style="margin-top:14px; display:flex; gap:12px;">
          <button type="submit" style="background:#1f8dff; color:white; border:none; padding:10px 14px; border-radius:6px; cursor:pointer;">Siųsti registraciją</button>
          <button type="button" onclick="resetForm()" style="background:#ddd; color:#333; border:none; padding:10px 14px; border-radius:6px; cursor:pointer;">Išvalyti</button>
        </div>
      </form>

      <div id="formMsg" style="margin-top:12px; display:none;"></div>
    </div>

    <!-- RIGHT: Car top-down selector + optional thumbnail -->
    <aside>
      <div style="margin-bottom:12px; font-weight:700">Žemėlapis: pažymėkite vietą</div>

      <div class="car-top card">
        <div class="car-body">
          <!-- simplified hotspots -->
          <button class="hotspot" data-area="front">Priekis</button>
          <button class="hotspot" data-area="rear">Galinė dalis</button>
          <button class="hotspot" data-area="left">Kairė pusė</button>
          <button class="hotspot" data-area="right">Dešinė pusė</button>
          <button class="hotspot" data-area="engine">Variklio skyrius</button>
          <button class="hotspot" data-area="interior">Salon / vidus</button>
        </div>
      </div>

      <p class="small-muted" style="margin-top:8px;">Pasirinkite automobilio vietą, kurioje jaučiate problemą.</p>
    </aside>
</div>

<!-- any global scripts would go here, e.g. app.js if you have it -->
<!-- <script src="app.js"></script> -->

<script>
  document.addEventListener('DOMContentLoaded', () => {
    initRepairPage();
  });

  function initRepairPage() {
    // hotspots
    document.querySelectorAll('.car-top .hotspot').forEach(btn => {
      btn.addEventListener('click', () => {
        document
          .querySelectorAll('.car-top .hotspot.selected')
          .forEach(x => x.classList.remove('selected'));
        btn.classList.add('selected');
        const area = btn.getAttribute('data-area');
        document.getElementById('selectedArea').value = area;
        document.getElementById('pickedArea').textContent = area;
      });
    });

    // enforce numeric phone
    const phone = document.getElementById('phone');
    if (phone) {
      phone.addEventListener('input', () => {
        phone.value = phone.value.replace(/[^\\d]/g, '').slice(0, 12);
      });
    }

    const form = document.getElementById('repairForm');
    if (form) {
      form.addEventListener('submit', (e) => {
        e.preventDefault();
        submitRepairForm();
      });
    }
  }

  async function submitRepairForm() {
    const firstName = document.getElementById('firstName').value.trim();
    const lastName = document.getElementById('lastName').value.trim();
    const plate = document.getElementById('plate').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const desc = document.getElementById('description').value.trim();
    const pickup = !!document.getElementById('pickupOpt').checked;
    const selectedArea = document.getElementById('selectedArea').value || null;

    if (!firstName || !lastName || !plate || !phone) {
      showFormMsg('Please fill name, last name, plate and phone.', true);
      return;
    }

    const symptoms = Array
      .from(document.querySelectorAll('input[name="symptom"]:checked'))
      .map(c => c.value);

    const payload = {
      firstName,
      lastName,
      plate,
      phone,
      desc,
      pickup,
      selectedArea,
      symptoms
    };

    try {
      const res = await fetch('repair_submit.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });

      if (!res.ok) throw new Error('Server error');

      const data = await res.json();

      if (data.ok) {
        showFormMsg('Registracija išsaugota. Mes susisieksime netrukus. (ID: ' + data.id + ')', false);
        resetForm();
      } else {
        showFormMsg('Nepavyko išsaugoti registracijos.', true);
      }
    } catch (err) {
      showFormMsg('Serverio klaida. Bandykite dar kartą.', true);
    }
  }

  function showFormMsg(text, isError) {
    const el = document.getElementById('formMsg');
    el.style.display = 'block';
    el.style.padding = '12px';
    el.style.borderRadius = '6px';
    el.style.background = isError ? '#ffe3e3' : '#e6ffed';
    el.style.color = isError ? '#8b0000' : '#0b6b2a';
    el.textContent = text;
    setTimeout(() => { el.style.display = 'none'; }, 6000);
  }

  function resetForm() {
    document.getElementById('repairForm').reset();
    document.getElementById('selectedArea').value = '';
    document.getElementById('pickedArea').textContent = 'Nenurodyta';
    document
      .querySelectorAll('.car-top .hotspot.selected')
      .forEach(x => x.classList.remove('selected'));
    document.getElementById('formMsg').style.display = 'none';
  }
</script>

</body>
</html>

